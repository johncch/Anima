/*
 (c) 2012-3 Chong Han Chua <johncch@outlook.com>
 Anima may be freely distributed under the MIT license
 http://github.com/johncch/Anima
*/
(function(){function u(a){console.log(typeof a);return"string"==typeof a?!a.match(/ms$/)&&a.match(/s$/)?1E3*parseFloat(a):parseInt(a):a}var c={},l=!1,j;a:{for(var v=["","webkit","Moz","O","Ms"],w=document.createElement("div"),q=0;q<v.length;q++){var r=v[q];w.cssText="-"+r+"-transition-property:opacity;";if("undefined"!=typeof w.style[r+"TransitionProperty"]){j=r;break a}}j="none"}var x="none"!=j,m,s,y,z,A,B,p;m=j+"Transform";s="-"+j.toLowerCase()+"-transform";y=j+"TransitionProperty";z=j+"TransitionDuration";
A=j+"TransitionDelay";B=j+"TransitionTimingFunction";p=function(){switch(j){case "Moz":return"transitionend";case "Ms":return"MSTransitionEnd";default:return j+"TransitionEnd"}}();var C=["scale"],D="top bottom left right opacity width height".split(" ");c.Defaults={Duration:"0.5s",Delay:"0",TimingFunction:"default"};c.parseTransitions=function(a,b){var f=[],e={},d;for(d in a)a.hasOwnProperty(d)&&(-1!=C.indexOf(d)?(-1==f.indexOf(s)&&f.push(s),e[m]||(e[m]=[]),e[m].push(d+"("+a[d]+")")):-1!=D.indexOf(d)&&
(-1==f.indexOf(d)&&f.push(d),e[d]=c.parseParams(a[d],d,b)));e[m]&&(e[m]=e[m].join(" "));return{keys:f,styles:e}};c.parseTime=function(a){return a?"string"==typeof a?a.match(/ms$/)||a.match(/s$/)?a:parseFloat(a)+"s":a+"s":null};c.parseArguments=function(a,b,c,e,d,h){var g={};a.element?(g.element=a.element,g.properties=a.properties,g.duration=a.duration,g.delay=a.delay,g.timingFunction=a.timingFunction,g.callback=a.callback):("function"==typeof e?(h=e,d=e=void 0):"string"==typeof e?(h=d,d=e,e=void 0):
"function"==typeof d&&(h=d,d=void 0),g.element=a,g.properties=b,g.duration=c,g.delay=e,g.timingFunction=d,g.callback=h);g.element=jQuery&&g.element instanceof jQuery?g.element.get():g.element;g.element.length&&1==g.element.length&&(g.element=g.element[0]);return g};c.parseParams=function(a,b,c){var e;switch(b){case "width":case "height":case "left":case "top":e=["px","em","pt"];if("string"==typeof a){if("="==a.charAt(1))return e=document.defaultView.getComputedStyle(c,null),b=c.style[b]||c.currentStyle[b]||
e.getPropertyValue(b),b=parseInt(b,10),c=parseInt(a.substr(2),10),a="+"==a.charAt(0)?1:-1,b+c*a+"px";for(b=0;b<e.length;b++)if(a.match(RegExp(""+e[b]+"$")))return a;return parseInt(a,10)+"px"}return a+"px";case "scale":return parseFloat(a);case "opacity":return a=parseFloat(a),a=1<a?1:a,0>a?0:a;default:return a}};var n=[],k=[],t=function(a){for(var b=0;b<k.length;b++)if(k[b]===a){k.splice(b,1);l&&console.log("[Anima] Removing runner. Remaining runners:");l&&console.log(k);break}};c.Animation=function(a,
b,f,e,d,h){a=c.parseArguments(a,b,f,e,d,h);this.element=a.element;this.properties=a.properties;this.duration=a.duration;this.delay=a.delay;this.timingFunction=a.timingFunction;this.callback=a.callback;this.completionHandler=null;a=document.defaultView.getComputedStyle(this.element,null);for(var g in this.properties)this.properties.hasOwnProperty(g)&&(this.element.style[g]||(this.element.style[g]=this.element.currentStyle?this.element.currentStyle[g]:a.getPropertyValue(g)))};c.Animation.prototype.run=
function(a){l&&console.log("[Anima] (Animation) Running animation");var b=this.transitions=c.parseTransitions(this.properties,this.element);this.style={};this.style[y]=b.keys.join(", ");var f=c.parseTime(this.duration)||c.Defaults.Duration;this.style[z]=f;var e=c.parseTime(this.delay)||c.Defaults.Delay;this.style[A]=e;this.style[B]=this.timingFunction||c.Defaults.TimingFunction;if(x){if(this.callback||a){var d=this.callback,h=this.element,g=this.style,f=u(f)+u(e)+100,j=this,k=this.completionHandler=
function(){l&&console.log("[Anima] (Animation) Animation completed");clearTimeout(j.timeout);h.removeEventListener(p,k);for(var b in g)g.hasOwnProperty(b)&&(h.style[b]="");d&&d.call(h);a&&setTimeout(a)};this.element.addEventListener(p,this.completionHandler);this.timeout=setTimeout(function(){k()},f)}for(var m in this.style)this.style.hasOwnProperty(m)&&(this.element.style[m]=this.style[m])}for(var n in b.styles)b.styles.hasOwnProperty(n)&&(this.element.style[n]=b.styles[n]);x||(this.callback&&this.callback.call(this.element),
a&&setTimeout(a))};c.Animation.prototype.abort=function(){clearTimeout(this.timeout);this.element.removeEventListener(p,this.completionHandler)};c.Animation.prototype.finish=function(a){a=void 0===a?!0:a;clearTimeout(this.timeout);this.element.removeEventListener(p,this.completionHandler);for(var b in this.style)this.element.style[b]="";c.css(this.element,this.properties);a&&this.callback&&this.callback.call(this.element)};c.Frame=function(a){this.operations=[];this.callback=a};c.Frame.prototype.queue=
function(a,b,f,e,d,h){a=c.parseArguments(a,b,f,e,d,h);if(a.element.length&&1<=a.element.length){for(b=0;b<a.element.length;b++)this.queue(a.element[b],a.properties,a.duration,a.delay,a.timingFunction);this.complete(a.callback)}else this.operations.push(new c.Animation(a.element,a.properties,a.duration,a.delay,a.timingFunction,a.callback));return this};c.Frame.prototype.run=function(a){var b=this.operations.length,c=this.callback;l&&console.log("[Anima] (Frame) running %d animations concurrently",
b);this.runCallback=a;for(var e=function(){l&&console.log("[Anima] (Frame) Callback at length %d",b);0===--b&&(c&&c.call(),a&&a.call())},d=0;d<b;d++)this.operations[d].run(e)};c.Frame.prototype.complete=function(a){this.callback=a};c.Frame.prototype.abort=function(){for(var a=0;a<this.operations.length;a++)this.operations[a].abort()};c.Frame.prototype.finish=function(a){a=void 0===a?!0:a;for(var b=0;b<this.operations.length;b++)this.operations[b].finish(a);a&&this.runCallback&&this.runCallback.call()};
c.Runner=function(a){this.operations=a instanceof Array?a:[a];this.activeOp=null};c.Runner.prototype.run=function(a){function b(){l&&console.log("[Anima] (Runner) Callback with cbLen %d",e);if(0===--e)t(c),a&&a.call();else{var d=c.operations.shift();c.activeOp=d;d.run(b)}}var c=this,e=this.operations.length;this.callback=a;l&&console.log("[Anima] (Runner) Start of run");k.push(this);l&&console.log("[Anima] (Runner) Number of runners");l&&console.log(k);var d=this.operations.shift();this.activeOp=
d;setTimeout(function(){d.run(b)})};c.Runner.prototype.abort=function(){l&&console.log("[Anima] (Runner) Aborting");this.operations=[];this.activeOp.abort();t(this)};c.Runner.prototype.finish=function(a){a=void 0===a?!0:a;this.activeOp.finish(a);for(var b=0;b<this.operations.length;b++)this.operations[b].finish(a);a&&this.callback&&this.callback.call(this);t(this)};c.queue=function(a,b,f,e,d,h){if(a instanceof c.Frame)n.push(a);else if(a=c.parseArguments(a,b,f,e,d,h),a.element.length&&1<a.element.length){b=
new c.Frame;for(f=0;f<a.element.length;f++)b.queue(a.element[f],a.properties,a.duration,a.delay,a.timingFunction);l&&console.log(a.callback);b.complete(a.callback);n.push(b)}else n.push(new c.Animation(a.element,a.properties,a.duration,a.delay,a.timingFunction,a.callback));return c};c.frame=function(a,b){a=a||[];for(var f=new c.Frame,e=0;e<a.length;e++){var d=a[e];f.queue(d.element,d.properties,d.duration,d.delay,d.timingFunction,d.callback)}f.complete(b);n.push(f);return f};c.play=function(a){var b=
new c.Runner(n);n=[];b.run(a);return b};c.step=function(a){var b=n.shift(),b=new c.Runner(b);b.run(a);return b};c.animate=function(a,b,f,e,d,h){c.queue(a,b,f,e,d,h);c.step()};c.abort=function(){for(var a=0;a<k.length;a++)k[a].abort()};c.finish=function(a){a=void 0===a?!0:a;for(var b=0;b<k.length;b++)k[b].finish(a)};c.css=function(a,b){var f=jQuery&&a instanceof jQuery?a.get():a;f.length&&1==f.length&&(f=f[0]);var e=c.parseTransitions(b,f),d;for(d in e.styles)f.style[d]=e.styles[d]};this.Anima=c})(this);
